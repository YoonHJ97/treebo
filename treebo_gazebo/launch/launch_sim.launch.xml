<?xml version='1.0' ?>
<launch>
  <arg name="robot_name" default="treebo"/>
  <arg name="world_name" default="treebo_world.world"/>
  <arg name="world" default="$(find-pkg-share treebo_gazebo)/worlds/$(var world_name)"/>
  <arg name="bridge_params" default="$(find-pkg-share treebo_gazebo)/params/treebo_bridge.yaml"/>

  <set_env name="GZ_SIM_RESOURCE_PATH"
           value="$(find-pkg-share treebo_description)/..:$(find-pkg-share treebo_gazebo)/models:$(find-pkg-share treebo_gazebo)/worlds"/>

  <!-- ✅ 서버+GUI 한 번만 실행. 쉼표(,) 절대 넣지 마세요 -->
  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name="gz_args" value="-r -g -v4 $(var world)"/>
    <arg name="on_exit_shutdown" value="true"/>
  </include>

  <!-- URDF 업로드 -->
  <include file="$(find-pkg-share treebo_description)/launch/upload.launch.xml">
    <arg name="use_sim_time" value="True"/>
  </include>

  <!-- 로봇 스폰 -->
  <node pkg="ros_gz_sim" exec="create" name="create" output="screen"
        args="-name $(var robot_name) -topic robot_description -x 0.0 -y 0.0">
    <param name="use_sim_time" value="True"/>
  </node>

  <!-- 브리지 -->
  <node pkg="ros_gz_bridge" exec="parameter_bridge" name="parameter_bridge" output="screen"
        args="--ros-args -p config_file:=$(var bridge_params)"/>
</launch>
